---
title: "making pie charts"
author: "Daniel Malone"
date: "2023-10-30"
output: html_document
---
```{r}
library(tidyverse)
library(readxl)
library(haven)
library(labelled)
library(dplyr)
library(tidyr)
library(writexl)
```


```{r}
#read in data set
dat = read.csv("C:/Users/malon/OneDrive/Documents/GitHub/Advanced-Data-Project-Daniel-Margo/Combined Transformed Vars.csv")
#simple scatter plot of log transformed population and the total crime rate
plot(dat$Ln.Pop, dat$Total.Crime.Rate)

#Create two dummy variables for whether the city had a zoning reform and whether the state had a zoning reform, respectively
dat$reformed = factor(ifelse(is.na(dat$reform_phase), 0, 1))
dat$statereformed = factor(ifelse(is.na(dat$Statewide.Reform), 0, 1))

#creates the mean of the total crime rate based on whether the city had a zoning reform or not, and the year
dat = dat|>
  group_by(reformed, year)|>
  mutate(meancrimerate = mean(Total.Crime.Rate))

#create two distinct data sets based on cities that had a reform and those that did not
reformeddat = dat|>
  filter(reformed == 1)
unreformeddat = dat|>
  filter(reformed == 0)

#make a plot which shows the mean crime rate of cities that reformed and cities that did not reform over time
ggplot(dat, aes(x = year, y = meancrimerate, color = reformed))+
  geom_point()
 
#run a number of regressions which generate the best fit lines for the above graph and show their values
reformedregression = lm(meancrimerate ~ year, data = reformeddat)
unreformedregression = lm(meancrimerate ~ year, data = unreformeddat)
regression = lm(meancrimerate ~ year + reformed, data = dat)
summary(reformedregression)
summary(unreformedregression)

#create another mean variable, this time calculating the mean of total crime rate for each state, and then creating two separate dummy variables for the two states (still present in the dataset) which had zoning reforms in 2021
dat = dat|>
  group_by(State, year)|>
  mutate(meanstatecrime = mean(Total.Crime.Rate))|>
  mutate(statecolors = factor(ifelse(State == "MAINE", 1,
                              ifelse(State == "OREGON", 2, 0))))

#make a plot of mean total crime per state, with Maine and Oregon displayed using unique colors relative to the other states, with a line connecting them.
ggplot(dat,aes(year, meanstatecrime, color = statecolors))+
  geom_line()+
  geom_point()
```